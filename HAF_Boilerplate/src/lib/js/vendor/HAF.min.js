/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(c){a.i18nT=c;};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(b){b.Base=Class.extend({_guid:null,messageBus:{publish:d,subscribe:d,unsubscribe:d},guid:function(){if(!this._guid){this._guid=c();
}return this._guid;},injectDependencies:function(f){e(this,f);}});b.Base.noop=d;function e(f,h){var g;if(b.Messaging&&(h instanceof b.Messaging)){f.messageBus=h;}var i=(h&&h.inject&&h.inject)||(f.inject&&f.inject());if(i){for(g in i){if(i.hasOwnProperty(g)){f[g]=i[g];}}}}function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();
}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}function d(){}}(HAF));(function(i){i.Controller=i.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,messages:null,inject:null,init:function(u){this.injectDependencies(u);},views:null,templates:null,controls:null,services:null,load:function(u){e(this,u);
m(this);a(this);},unload:function(){l(this);j(this);g(this);},update:function(u){d(this,u);},onUpdateReceive:function(v,u){h(this,v,u);},destroy:function(){s(this);},render:function(u,v){if(this.autoWire){this.views[v].render(this.templates[v].process(u));}},onStateChange:i.Base.noop,onShow:function(){f(this,true);
k(this);},onHide:function(){o(this);f(this,false);n(this);},hide:function(){f(this,false);o(this);},show:function(){f(this,true);p(this);}});function g(u){q(u.controls,"unload");}function a(u){if(u.autoLoadControls){q(u.controls,"load");}}function k(u){if(!u._exist&&u.autoWire){t(u.services,u);}u._exist=true;
}function n(u){if(u.autoDestroy){u.destroy();}}function p(u){if(u.autoWire){q(u.services,"start");}}function o(u){if(u.autoWire){q(u.services,"stop");}}function h(u,w,v){u.controls[v].update(w);if(u.lastStateData&&u.onStateChange()[v]){u.onStateChange()[v].call(u,u.controls[v],u.lastStateData);}}function e(u,w){var v=u.templates;
if(v&&u.autoWire){b(u,w,v);}}function d(u,v){if(u.autoWire){r(u,v);}}function s(u){j(u);l(u);q(u.views,"destroy");q(u.controls,"destroy");q(u.services,"destroy");u.services=null;u.views=null;u.lastStateData=null;u.templates=null;u.options=null;u.controls=null;u._exist=false;}function j(u){if(u.controlMessages){var v=u.controlMessages;
i.messaging.unsubscribe(v.show);i.messaging.unsubscribe(v.hide);i.messaging.unsubscribe(v.stateChange);}}function l(u){if(u.messages){var v;for(v in u.messages){if(u.messages.hasOwnProperty(v)){i.messaging.unsubscribe(u.messages[v]);}}}}function r(u,x){var v=u.templates,w;for(w in v){if(v.hasOwnProperty(w)){u.render(x,w);
}}}function q(w,x,v){var u;if(w){for(u in w){if(w.hasOwnProperty(u)){w[u][x](v);}}}}function t(v,w){var u;if(v){for(u in v){if(v.hasOwnProperty(u)){v[u].onUpdate(c(w,u));v[u].fetch();}}}}function c(v,u){return function(w){v.onUpdateReceive(w,u);};}function m(u){if(!(u.messages||u.controlMessages)){return;
}var w=u.controlMessages;i.messaging.subscribe(u,w.show,u.onShow);i.messaging.subscribe(u,w.hide,u.onHide);i.messaging.subscribe(u,w.stateChange,function(x){u.lastStateData=x;var z=u.onStateChange(),y;for(y in z){if(z.hasOwnProperty(y)){z[y].call(u,u.controls[y],x);}}});w=u.messages;var v;for(v in w){if(w.hasOwnProperty(v)){i.messaging.subscribe(u,v,w[v]);
}}}function b(w,x,u){var v;var y=function(z){return function(){w.render(x,z);};};for(v in u){if(u.hasOwnProperty(v)){u[v].load(y(v));}}}function f(v,u){if(v.autoShowHide){q(v.views,u?"show":"hide");q(v.controls,u?"show":"hide");}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};
a[this.guid()].updateCallBack=[];},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);});},update:b.Base.noop,get:b.Base.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);},updated:function(f){var g,e;var d=a[this.guid()];
d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];},stop:b.Base.noop,start:b.Base.noop});}(HAF,HAF.DOM));(function(a){var b={};a.Template=a.Base.extend({init:function(c,d){this.path=c;this.loadBy=d||a.Template.LOAD.DEFAULT;
if(this.loadBy===a.Template.LOAD.BY_ID){if(!b[this.guid()]){b[this.guid()]=a.templateEngine.getById(c);a.templateEngine.remove(c);}}},process:function(c){if(!b[this.guid()]){throw new Error("Template not in cache!!");}return a.templateEngine.process(b[this.guid()],c);},load:function(d){var c=this;if(c.loadBy===a.Template.LOAD.BY_URL){if(b[this.guid()]){d();
}a.templateEngine.getByURL(c.path,function(e){b[this.guid()]=e;d();});}else{d();}},destroy:function(){delete b[this.guid()];}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",DEFAULT:"APP_TEMPLATE_BY_ID"};}(HAF));(function(a,b){a.View=a.Base.extend({init:function(c){this.injectDependencies(c);
this.$container=b(this.container);this.$el=this.$container.$item;this.bind();},container:null,$container:null,$el:null,render:function(c){this.$container.html(c);},destroy:function(){this.$container.empty();},bind:a.Base.noop,hide:function(){this.$el.hide();},show:function(){this.$el.show();}});}(HAF,HAF.DOM));
(function(){Handlebars.registerHelper("list",function(b,d){var c="<ul>",e,a;if(b&&b.length){for(e=0,a=b.length;e<a;e++){c+="<li>"+d.fn(b[e])+"</li>";}}return c+"</ul>";});}());(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));
});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";
};}(HAF));(function(a,c){var b=function(){this.messageBus=c({});};b.prototype={publish:function(d,e){this.messageBus.trigger(d,[e]);},subscribe:function(f,e,g){var d=function(i,h){g.call(f,h);};this.messageBus.on(e,d);return d;},unsubscribe:function(d,e){this.messageBus.off(d,e);}};a.messaging=new b();
a.Messaging=b;}(HAF,HAF.DOM));(function(a,e){var f;var b;var d={};var c=function(){function l(m){e(window).on("hashchange",j);if(location.hash){j();}else{location.href="#/"+m;}}function j(){b=location.hash;var m=k(b);if(m.page!==f){g(f,m);f=m.page;h(f,m);}d[f]=m;a.messaging.publish("navigationStateChange:"+f,m);
a.messaging.publish("navigationStateChange",m);}function g(n,m){if(n){e("a[href$='#/"+n+"']").removeClass("selected");e("#"+n).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+n,m);}}function h(o,m){e("#"+o).addClass("page-visible");e("a[href$='#/"+o+"']").addClass("selected");
var n=d[o];if(n){if(n.moduleItem){location.replace("#/"+o+"/"+n.module+"/"+n.moduleItem);}}a.messaging.publish("navigationChangedTo:"+f,m);}function k(n){var m=n.substr(1).split("/");return{path:n,page:m[1],module:m[2],moduleItem:m[3]};}function i(o,p,q,m){var n=new RegExp(("^"+p+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(r){return"([a-zA-Z0-9-_]+)";
})).exec(b.substring(1).replace(/[\/]?$/,""));if(n){n.splice(0,1);q.apply(o,n);}else{if(m){m.call(o);}}}return{load:l,route:i};};a.navigation=new c();}(HAF,HAF.DOM));(function(c,e){c.templateEngine={getById:g,getByCSSSelector:d,getByURL:b,process:f,remove:a};function b(i,j){e.get(i,function(k){j(h(k));
});}function h(i){return Handlebars.compile(i);}function a(j){var i=e("#"+j);i.remove();}function g(k){var i=e("#"+k);var j=i.html();i.remove();if(!j){throw new Error("Template id: "+k+", not found!!");}else{return h(j);}}function d(j){var i=e(j).html();if(!i){throw new Error("Template selector: "+j+", not matched any!!");
}else{return h(i);}}function f(j,i){return j(i);}}(HAF,HAF.DOM));