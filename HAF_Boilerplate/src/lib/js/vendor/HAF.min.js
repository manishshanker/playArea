/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(c){a.i18nT=c;};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(b){b.Base=Class.extend({_guid:null,guid:function(){if(!this._guid){this._guid=c();
}return this._guid;}});b.Base.noop=d;function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}function d(){}}(HAF));(function(h){h.Controller=h.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,messages:null,init:function(t){this.options=t;
},views:null,templates:null,controls:null,services:null,load:function(t){e(this,t);},onUpdateReceive:function(u,t){g(this,u,t);},destroy:function(){r(this);},render:function(t,u){if(this.autoWire){this.views[u].render(this.templates[u].process(t));}},inject:function(t){this.views=t.views||this.views;
this.templates=t.templates||this.templates;this.services=t.services||this.services;this.controls=t.controls||this.controls;},onStateChange:h.Base.noop,onShow:function(){f(this,true);j(this);},onHide:function(){n(this);f(this,false);m(this);},hide:function(){f(this,false);n(this);},show:function(){f(this,true);
o(this);}});function e(t,u){if(!t._loaded){d(t,u);l(t);t._loaded=true;}else{c(t,u);}}function j(t){if(!t._exist&&t.autoWire){s(t.services,t);}t._exist=true;}function m(t){if(t.autoDestroy){t.destroy();}}function o(t){if(t.autoWire){p(t.services,"start");}}function n(t){if(t.autoWire){p(t.services,"stop");
}}function g(t,v,u){t.controls[u].load(v);if(t.lastStateData&&t.onStateChange()[u]){t.onStateChange()[u].call(t,t.controls[u],t.lastStateData);}}function d(t,v){var u=t.templates;if(u&&t.autoWire){a(t,v,u);}}function c(t,u){if(t.autoWire){q(t,u);}}function r(t){i(t);k(t);p(t.views,"destroy");p(t.controls,"destroy");
p(t.services,"destroy");t.services=null;t.views=null;t.lastStateData=null;t.templates=null;t.options=null;t.controls=null;t._loaded=false;t._exist=false;}function i(t){if(t.controlMessages){var u=t.controlMessages;h.messaging.unsubscribe(u.show);h.messaging.unsubscribe(u.hide);h.messaging.unsubscribe(u.stateChange);
}}function k(t){if(t.messages){var u;for(u in t.messages){if(t.messages.hasOwnProperty(u)){h.messaging.unsubscribe(t.messages[u]);}}}}function q(t,w){var u=t.templates,v;for(v in u){if(u.hasOwnProperty(v)){t.render(w,v);}}}function p(v,w,u){var t;if(v){for(t in v){if(v.hasOwnProperty(t)){v[t][w](u);}}}}function s(u,v){var t;
if(u){for(t in u){if(u.hasOwnProperty(t)){u[t].onUpdate(b(v,t));u[t].fetch();}}}}function b(u,t){return function(v){u.onUpdateReceive(v,t);};}function l(t){if(!(t.messages||t.controlMessages)){return;}var v=t.controlMessages;h.messaging.subscribe(t,v.show,t.onShow);h.messaging.subscribe(t,v.hide,t.onHide);
h.messaging.subscribe(t,v.stateChange,function(w){t.lastStateData=w;var y=t.onStateChange(),x;for(x in y){if(y.hasOwnProperty(x)){y[x].call(t,t.controls[x],w);}}});v=t.messages;var u;for(u in v){if(v.hasOwnProperty(u)){h.messaging.subscribe(t,u,v[u]);}}}function a(v,w,t){var u;var x=function(y){return function(){v.render(w,y);
};};for(u in t){if(t.hasOwnProperty(u)){t[u].load(x(u));}}}function f(u,t){if(u.autoShowHide){p(u.views,t?"show":"hide");p(u.controls,t?"show":"hide");}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);
});},update:b.Base.noop,get:b.Base.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];
},stop:b.Base.noop,start:b.Base.noop});}(HAF,HAF.DOM));(function(a){var b={};a.Template=a.Base.extend({init:function(c,d){this.path=c;this.loadBy=d||a.Template.LOAD.DEFAULT;if(this.loadBy===a.Template.LOAD.BY_ID){b[this.guid()]=b[this.guid()]||a.templateEngine.getById(c);}},process:function(c){if(!b[this.guid()]){throw new Error("Template not in cache!!");
}return a.templateEngine.process(b[this.guid()],c);},load:function(d){var c=this;if(c.loadBy===a.Template.LOAD.BY_URL){if(b[this.guid()]){d();}a.templateEngine.getByURL(c.path,function(e){b[this.guid()]=e;d();});}else{d();}},destroy:function(){delete b[this.guid()];}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",DEFAULT:"APP_TEMPLATE_BY_ID"};
}(HAF));(function(a,b){a.View=a.Base.extend({init:function(){this.$container=b(this.container);this.$el=this.$container.$item;},container:null,$container:null,$el:null,render:function(c){this.$container.html(c);},destroy:function(){this.$container.empty();},bind:a.Base.noop,hide:function(){this.$el.hide();
},show:function(){this.$el.show();}});}(HAF,HAF.DOM));(function(){Handlebars.registerHelper("list",function(b,d){var c="<ul>",e,a;for(e=0,a=b.length;e<a;e++){c=c+"<li>"+d.fn(b[e])+"</li>";}return c+"</ul>";});}());(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;
return new Handlebars.SafeString(a.i18n(b,c));});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");
b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(HAF));(function(a,c){var b=function(){var e=c({});function f(h,i){e.trigger(h,[i]);}function d(i,h,j){e.on(h,function(l,k){j.call(i,k);});}function g(h){e.off(h);}return{publish:f,subscribe:d,unsubscribe:g};};a.messaging=new b();
a.Messaging=b;}(HAF,HAF.DOM));(function(a,e){var f;var b;var d={};var c=function(){function l(m){e(window).on("hashchange",j);if(location.hash){j();}else{location.href="#/"+m;}}function j(){b=location.hash;var m=k(b);if(m.page!==f){g(f,m);f=m.page;h(f,m);}d[f]=m;a.messaging.publish("navigationStateChange:"+f,m);
a.messaging.publish("navigationStateChange",m);}function g(n,m){if(n){e("a[href$='#/"+n+"']").removeClass("selected");e("#"+n).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+n,m);}}function h(o,m){e("#"+o).addClass("page-visible");e("a[href$='#/"+o+"']").addClass("selected");
var n=d[o];if(n){if(n.moduleItem){location.replace("#/"+o+"/"+n.module+"/"+n.moduleItem);}}a.messaging.publish("navigationChangedTo:"+f,m);}function k(n){var m=n.substr(1).split("/");return{path:n,page:m[1],module:m[2],moduleItem:m[3]};}function i(o,p,q,m){var n=new RegExp(("^"+p+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(r){return"([a-zA-Z0-9-_]+)";
})).exec(b.substring(1).replace(/[\/]?$/,""));if(n){n.splice(0,1);q.apply(o,n);}else{if(m){m.call(o);}}}return{load:l,route:i};};a.navigation=new c();}(HAF,HAF.DOM));(function(b,d){b.templateEngine={getById:f,getByCSSSelector:c,getByURL:a,process:e};function a(h,i){d.get(h,function(j){i(g(j));});}function g(h){return Handlebars.compile(h);
}function f(j){var h=d("#"+j);var i=h.html();h.remove();if(!i){throw new Error("Template id: "+j+", not found!!");}else{return g(i);}}function c(i){var h=d(i).html();if(!h){throw new Error("Template selector: "+i+", not matched any!!");}else{return g(h);}}function e(i,h){return i(h);}}(HAF,HAF.DOM));
