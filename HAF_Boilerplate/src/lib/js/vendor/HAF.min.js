/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(c){a.i18nT=c;};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(b){b.Base=Class.extend({_guid:null,guid:function(){if(!this._guid){this._guid=c();
}return this._guid;}});b.Base.noop=d;function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}function d(){}}(HAF));(function(g){g.Controller=g.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,messages:null,init:function(s){this.options=s;
},views:null,templates:null,controls:null,services:null,load:function(s){d(this,s);},onUpdateReceive:function(t,s){f(this,t,s);},destroy:function(){q(this);},render:function(s,t){if(this.autoWire){this.views[t].render(this.templates[t].process(s));}},inject:function(s){this.views=s.views||this.views;
this.templates=s.templates||this.templates;this.services=s.services||this.services;this.controls=s.controls||this.controls;},onStateChange:g.Base.noop,onShow:function(){e(this,true);i(this);},onHide:function(){m(this);e(this,false);l(this);},hide:function(){e(this,false);m(this);},show:function(){e(this,true);
n(this);}});function i(s){if(!s._exist&&s.autoWire){r(s.services,s);}s._exist=true;}function l(s){if(s.autoDestroy){s.destroy();}}function n(s){if(s.autoWire){o(s.services,"start");}}function m(s){if(s.autoWire){o(s.services,"stop");}}function f(s,u,t){s.controls[t].load(u);if(s.lastStateData&&s.onStateChange()[t]){s.onStateChange()[t].call(s,s.controls[t],s.lastStateData);
}}function c(s,u){var t=s.templates;if(t&&s.autoWire){a(s,u,t);}}function d(s,t){if(!s._loaded){c(s,t);k(s);s._loaded=true;}else{if(s.autoWire){p(s,t);}}}function q(s){h(s);j(s);o(s.views,"destroy");o(s.controls,"destroy");o(s.services,"destroy");s.services=null;s.views=null;s.lastStateData=null;s.templates=null;
s.options=null;s.controls=null;s._loaded=false;s._exist=false;}function h(s){if(s.controlMessages){var t=s.controlMessages;g.messaging.unsubscribe(t.show);g.messaging.unsubscribe(t.hide);g.messaging.unsubscribe(t.stateChange);}}function j(s){if(s.messages){var t;for(t in s.messages){if(s.messages.hasOwnProperty(t)){g.messaging.unsubscribe(s.messages[t]);
}}}}function p(s,v){var t=s.templates,u;for(u in t){if(t.hasOwnProperty(u)){s.render(v,u);}}}function o(u,v,t){var s;if(u&&u.length){for(s in u){if(u.hasOwnProperty(s)){u[s][v](t);}}}}function r(t,u){var s;for(s in t){if(t.hasOwnProperty(s)){t[s].onUpdate(b(u,s));t[s].fetch();}}}function b(t,s){return function(u){t.onUpdateReceive(u,s);
};}function k(s){if(!(s.messages||s.controlMessages)){return;}var u=s.controlMessages;g.messaging.subscribe(s,u.show,s.onShow);g.messaging.subscribe(s,u.hide,s.onHide);g.messaging.subscribe(s,u.stateChange,function(v){s.lastStateData=v;var x=s.onStateChange(),w;for(w in x){if(x.hasOwnProperty(w)){x[w].call(s,s.controls[w],v);
}}});u=s.messages;var t;for(t in u){if(u.hasOwnProperty(t)){g.messaging.subscribe(s,t,u[t]);}}}function a(u,v,s){var t;var w=function(x){return function(){u.render(v,x);};};for(t in s){if(s.hasOwnProperty(t)){s[t].load(w(t));}}}function e(t,s){if(t.autoShowHide){o(t.views,s?"show":"hide");o(t.controls,s?"show":"hide");
}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);});},update:b.Base.noop,get:b.Base.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);
},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];},stop:b.Base.noop,start:b.Base.noop});}(HAF,HAF.DOM));(function(a){var b={};a.Template=Class.extend({init:function(c,d){this.path=c;
this.loadBy=d||a.Template.LOAD.DEFAULT;if(this.loadBy===a.Template.LOAD.BY_ID){b[c]=b[c]||a.templateEngine.getById(c);}},process:function(c){if(!b[this.path]){throw new Error("Template not in cache!!");}return a.templateEngine.process(b[this.path],c);},load:function(d){var c=this;if(c.loadBy===a.Template.LOAD.BY_URL){if(b[c.path]){d();
}a.templateEngine.getByURL(c.path,function(e){b[c.path]=e;d();});}else{d();}}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",DEFAULT:"APP_TEMPLATE_BY_ID"};}(HAF));(function(a,b){a.View=a.Base.extend({init:function(){this.$container=b(this.container);this.$el=this.$container.$item;
},container:null,$container:null,$el:null,render:function(c){this.$container.html(c);},destroy:function(){this.$container.empty();},bind:a.Base.noop,hide:function(){this.$el.hide();},show:function(){this.$el.show();}});}(HAF,HAF.DOM));(function(){Handlebars.registerHelper("list",function(b,d){var c="<ul>",e,a;
for(e=0,a=b.length;e<a;e++){c=c+"<li>"+d.fn(b[e])+"</li>";}return c+"</ul>";});}());(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");
}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(HAF));(function(a,c){var b=function(){var e=c(document);function f(h,i){e.trigger(h,[i]);
}function d(i,h,j){e.on(h,function(l,k){j.call(i,k);});}function g(h){e.off(h);}return{publish:f,subscribe:d,unsubscribe:g};};a.messaging=new b();}(HAF,HAF.DOM));(function(a,e){var f;var b;var d={};var c=function(){function l(m){e(window).on("hashchange",j);if(location.hash){j();}else{location.href="#/"+m;
}}function j(){b=location.hash;var m=k(b);if(m.page!==f){g(f,m);f=m.page;h(f,m);}d[f]=m;a.messaging.publish("navigationStateChange:"+f,m);a.messaging.publish("navigationStateChange",m);}function g(n,m){if(n){e("a[href$='#/"+n+"']").removeClass("selected");e("#"+n).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+n,m);
}}function h(o,m){e("#"+o).addClass("page-visible");e("a[href$='#/"+o+"']").addClass("selected");var n=d[o];if(n){if(n.moduleItem){location.replace("#/"+o+"/"+n.module+"/"+n.moduleItem);}}a.messaging.publish("navigationChangedTo:"+f,m);}function k(n){var m=n.substr(1).split("/");return{path:n,page:m[1],module:m[2],moduleItem:m[3]};
}function i(o,p,q,m){var n=new RegExp(("^"+p+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(r){return"([a-zA-Z0-9-_]+)";})).exec(b.substring(1).replace(/[\/]?$/,""));if(n){n.splice(0,1);q.apply(o,n);}else{if(m){m.call(o);}}}return{load:l,route:i};};a.navigation=new c();}(HAF,HAF.DOM));(function(b,d){b.templateEngine={getById:f,getByCSSSelector:c,getByURL:a,process:e};
function a(h,i){d.get(h,function(j){i(g(j));});}function g(h){return Handlebars.compile(h);}function f(j){var h=d("#"+j);var i=h.html();h.remove();if(!i){throw new Error("Template id: "+j+", not found!!");}else{return g(i);}}function c(i){var h=d(i).html();if(!h){throw new Error("Template selector: "+i+", not matched any!!");
}else{return g(h);}}function e(i,h){return i(h);}}(HAF,HAF.DOM));