/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(c){a.i18nT=c;};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(c){c.Controller=Class.extend({autoWire:false,autoDestroy:false,autoShowHide:false,init:function(h){this.options=h;
},views:null,templates:null,controls:null,services:null,render:function(h,i){this.views[i].render(this.templates[i].process(h));},_render:function(j){var h=this.templates,i;for(i in h){if(h.hasOwnProperty(i)){this.render(j,i);}}},inject:function(h){this.views=h.views||this.views;this.templates=h.templates||this.templates;
this.services=h.services||this.services;this.controls=h.controls||this.controls;},load:function(j){var i=this;if(!i._loaded){var h=this.templates;if(h&&this.autoWire){g(i,j,h);}if(i.messages||i.controlMessages){a(i);}i._loaded=true;}else{if(this.autoWire){this._render(j);}}},onStateChange:function(){},onUpdateReceive:function(j,i){var h=this;
h.controls[i].load(j);if(h.lastStateData&&h.onStateChange()[i]){h.onStateChange()[i].call(h,h.controls[i],h.lastStateData);}},destroy:function(){if(this.controlMessages){var h=this.controlMessages;c.messaging.unsubscribe(h.show);c.messaging.unsubscribe(h.hide);c.messaging.unsubscribe(h.stateChange);}if(this.messages){var i;
for(i in this.messages){if(this.messages.hasOwnProperty(i)){c.messaging.unsubscribe(this.messages[i]);}}}if(this.views){b(this.views,"destroy");}if(this.controls){b(this.controls,"destroy");}if(this.services){b(this.services,"destroy");}this.services=null;this.views=null;this.lastStateData=null;this.templates=null;
this.options=null;this.controls=null;this._loaded=false;this._exist=false;},onShow:function(){d(this,true);if(!this._exist&&this.autoWire){f(this.services,this);}this._exist=true;},hide:function(){d(this,false);if(this.autoWire){b(this.services,"stop");}},show:function(){d(this,true);if(this.autoWire){b(this.services,"start");
}},onHide:function(){if(this.autoWire){b(this.services,"stop");}d(this,false);if(this.autoDestroy){this.destroy();}}});function b(j,k,i){var h;if(j){for(h in j){if(j.hasOwnProperty(h)){j[h][k](i);}}}}function f(i,j){var h;for(h in i){if(i.hasOwnProperty(h)){i[h].onUpdate(e(j,h));i[h].fetch();}}}function e(i,h){return function(j){i.onUpdateReceive(j,h);
};}function a(j){var i=j.controlMessages;c.messaging.subscribe(j,i.show,j.onShow);c.messaging.subscribe(j,i.hide,j.onHide);c.messaging.subscribe(j,i.stateChange,function(k){j.lastStateData=k;var m=j.onStateChange(),l;for(l in m){if(m.hasOwnProperty(l)){m[l].call(j,j.controls[l],k);}}});i=j.messages;var h;
for(h in i){if(i.hasOwnProperty(h)){c.messaging.subscribe(j,h,i[h]);}}}function g(j,k,h){var i;var l=function(m){return function(){j.render(k,m);};};for(i in h){if(h.hasOwnProperty(i)){h[i].load(l(i));}}}function d(i,h){if(i.autoShowHide){b(i.views,h?"show":"hide");b(i.controls,h?"show":"hide");}}}(HAF));
(function(b,d){var c=function(){};var a={};b.Service=Class.extend({dataURL:null,fetch:function(){d.get(this.dataURL,function(e){this.updated(e);});},update:c,get:c,lastResult:function(){return a[this._id_].lastResult;},onUpdate:function(e){a[this._id_].updateCallBack.push(e);},init:function(){this._id_=(new Date()).getTime()+Math.floor(Math.random()*1000000);
a[this._id_]={};a[this._id_].updateCallBack=[];},updated:function(f){var h,e;var g=a[this._id_];g.lastResult=f;if(g){for(h=0,e=g.updateCallBack.length;h<e;h++){g.updateCallBack[h](f);}}},destroy:function(){delete a[this._id_];},stop:c,start:c});}(HAF,HAF.DOM));(function(a){var b={};a.Template=Class.extend({init:function(c,d){this.path=c;
this.loadBy=d||a.Template.LOAD.DEFAULT;if(this.loadBy===a.Template.LOAD.BY_ID){b[c]=b[c]||a.templateEngine.getById(c);}},process:function(c){if(!b[this.path]){throw new Error("Template not in cache!!");}return a.templateEngine.process(b[this.path],c);},load:function(d){var c=this;if(c.loadBy===a.Template.LOAD.BY_URL){if(b[c.path]){d();
}a.templateEngine.getByURL(c.path,function(e){b[c.path]=e;d();});}else{d();}}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",DEFAULT:"APP_TEMPLATE_BY_ID"};}(HAF));(function(a,c){a.View=Class.extend({init:function(){this.$container=c(this.container);this.$el=this.$container.$item;
},container:null,$container:null,$el:null,render:function(d){this.$container.html(d);},destroy:function(){this.$container.empty();},bind:b,hide:function(){this.$el.hide();},show:function(){this.$el.show();}});function b(){}}(HAF,HAF.DOM));(function(){Handlebars.registerHelper("list",function(b,d){var c="<ul>",e,a;
for(e=0,a=b.length;e<a;e++){c=c+"<li>"+d.fn(b[e])+"</li>";}return c+"</ul>";});}());(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");
}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(HAF));(function(a,c){var b=function(){var e=c(document);function f(h,i){e.trigger(h,[i]);
}function d(i,h,j){e.on(h,function(l,k){j.call(i,k);});}function g(h){e.off(h);}return{publish:f,subscribe:d,unsubscribe:g};};a.messaging=new b();}(HAF,HAF.DOM));(function(a,e){var f;var b;var d={};var c=function(){function l(m){e(window).on("hashchange",j);if(location.hash){j();}else{location.href="#/"+m;
}}function j(){b=location.hash;var m=k(b);if(m.page!==f){g(f,m);f=m.page;h(f,m);}d[f]=m;a.messaging.publish("navigationStateChange:"+f,m);a.messaging.publish("navigationStateChange",m);}function g(n,m){if(n){e("a[href$='#/"+n+"']").removeClass("selected");e("#"+n).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+n,m);
}}function h(o,m){e("#"+o).addClass("page-visible");e("a[href$='#/"+o+"']").addClass("selected");var n=d[o];if(n){if(n.moduleItem){location.replace("#/"+o+"/"+n.module+"/"+n.moduleItem);}}a.messaging.publish("navigationChangedTo:"+f,m);}function k(n){var m=n.substr(1).split("/");return{path:n,page:m[1],module:m[2],moduleItem:m[3]};
}function i(o,p,q,m){var n=new RegExp(("^"+p+"$").replace("?",".").replace(/:[a-zA-Z0-9]+/g,function(r){return"([a-zA-Z0-9]+)";})).exec(b.substring(1));if(n){n.splice(0,1);q.apply(o,n);}else{if(m){m.call(o);}}}return{load:l,route:i};};a.navigation=new c();}(HAF,HAF.DOM));(function(b,d){b.templateEngine={getById:f,getByCSSSelector:c,getByURL:a,process:e};
function a(h,i){d.get(h,function(j){i(g(j));});}function g(h){return Handlebars.compile(h);}function f(j){var h=d("#"+j);var i=h.html();h.remove();if(!i){throw new Error("Template id: "+j+", not found!!");}else{return g(i);}}function c(i){var h=d(i).html();if(!h){throw new Error("Template selector: "+i+", not matched any!!");
}else{return g(h);}}function e(i,h){return i(h);}}(HAF,HAF.DOM));