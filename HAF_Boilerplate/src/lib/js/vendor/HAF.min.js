/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(c){a.i18nT=c;};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(c){var a={publish:g,subscribe:g,unsubscribe:g};c.Base=Class.extend({_guid:null,messageBus:a,parentMessageBus:a,guid:function(){if(!this._guid){this._guid=d();
}return this._guid;},injectDependencies:function(i){h(this,i);}});c.noop=g;c.each=function(i,j){if(i){if(i instanceof Array){f(i,j);}else{e(i,j);}}};function e(i,k){var j;if(i){for(j in i){if(i.hasOwnProperty(j)){k(i[j],j);}}}}function f(m,n){var k,j;if(m){for(k=0,j=m.length;k<j;k++){n(m[k],k);}}}function h(i,j){if(c.Messaging&&(j instanceof c.Messaging)){i.parentMessageBus=j;
}if(i.injectMessageBus){i.messageBus=(j&&j.inject&&j.inject.messageBus)||new c.Messaging();}var k=(j&&j.inject)||(i.inject&&i.inject());c.each(k,function(l,m){i[m]=l;});}function d(){return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();}function b(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);
}function g(){}}(HAF));(function(g){g.Controller=g.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,autoLayout:false,messages:null,injectMessageBus:false,inject:null,routes:{},serviceUpdate:{},parentMessageBus:null,messageBus:null,init:function(s){this.injectDependencies(s);
},views:null,templates:null,controls:null,services:null,layoutChange:function(){if(this.autoLayout){p(this.controls,"layoutChange");p(this.views,"layoutChange");}},load:function(){k(this);a(this);},unload:function(){j(this);e(this);},update:function(s){c(this,s);},onUpdateReceive:function(t,s){f(this,t,s);
},destroy:function(){q(this);},onRouteChange:function(){return this.routes;},onServiceUpdate:function(){return this.serviceUpdate;},onShow:function(){d(this,true);i(this);},onHide:function(){m(this);d(this,false);l(this);},hide:function(){d(this,false);m(this);},show:function(){d(this,true);n(this);}});
function e(s){p(s.controls,"unload");}function a(s){if(s.autoLoadControls){p(s.controls,"load");}}function i(s){if(!s._exist&&s.autoWire){r(s.services,s);}s._exist=true;}function l(s){if(s.autoDestroy){s.destroy();}}function n(s){if(s.autoWire){p(s.services,"start");}}function m(s){if(s.autoWire){p(s.services,"stop");
}}function f(s,u,t){s.controls[t].update(u);if(s.lastStateData&&s.onServiceUpdate()[t]){s.onServiceUpdate()[t].call(s,s.controls[t],s.lastStateData);}}function c(s,t){if(s.autoWire){o(s,t);}}function q(s){h(s);j(s);p(s.views,"destroy");p(s.controls,"destroy");p(s.services,"destroy");s.services=null;s.views=null;
s.lastStateData=null;s.templates=null;s.options=null;s.controls=null;s._exist=false;}function h(s){if(s.controlMessages){var t=s.controlMessages;g.messaging.unsubscribe(t.show);g.messaging.unsubscribe(t.hide);g.messaging.unsubscribe(t.stateChange);}}function j(s){g.each(s.messages,function(t){g.messaging.unsubscribe(t);
});}function o(s,t){g.each(s.templates,function(v,u){s.views[u].render(v.process(t));});}function p(t,u,s){g.each(t,function(v){v[u](s);});}function r(s,t){g.each(s,function(u,v){u.onUpdate(b(t,v));u.fetch();});}function b(t,s){return function(u){t.onUpdateReceive(u,s);};}function k(s){if(!(s.messages||s.controlMessages)){return;
}h(s);var t=s.controlMessages;g.messaging.subscribe(s,t.show,s.onShow);g.messaging.subscribe(s,t.hide,s.onHide);g.messaging.subscribe(s,t.stateChange,function(u){s.lastStateData=u;g.each(s.onRouteChange(u),function(w,v){g.navigation.route(s,v,w);});});g.each(s.messages,function(v,u){g.messaging.subscribe(s,u,v);
});}function d(t,s){if(t.autoShowHide){p(t.views,s?"show":"hide");p(t.controls,s?"show":"hide");}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);
});},update:b.noop,get:b.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];
},stop:b.noop,start:b.noop});}(HAF,HAF.DOM));(function(a){var b={};a.Template=a.Base.extend({init:function(c,d){this.path=c;this.loadBy=d||a.Template.LOAD.DEFAULT;if(this.loadBy===a.Template.LOAD.BY_ID){if(!b[this.guid()]){b[this.guid()]=a.templateEngine.getById(c);a.templateEngine.remove(c);}}},process:function(c){if(!b[this.guid()]){throw new Error("Template not in cache!!");
}return a.templateEngine.process(b[this.guid()],c);},load:function(d){var c=this;if(c.loadBy===a.Template.LOAD.BY_URL){if(b[this.guid()]){d();}a.templateEngine.getByURL(c.path,function(e){b[c.guid()]=e;d();});}else{d();}},destroy:function(){delete b[this.guid()];}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",DEFAULT:"APP_TEMPLATE_BY_ID"};
}(HAF));(function(b,c){b.View=b.Base.extend({autoManageEventBind:false,autoLayout:false,init:function(e){this.injectDependencies(e);this.$container=c(this.container);this.$el=this.$container.$item;if(!this.autoManageEventBind){this.bind();}},container:null,$container:null,bindings:null,layoutChange:b.noop,bind:function(){d(this);
},unbind:function(){a(this);},$el:null,render:function(e){this.$container.html(e);},destroy:function(){this.unbind();this.$container.empty();},hide:function(){var e=this;e.$el.hide();if(e.autoManageEventBind){e.unbind();}if(e.autoLayout){c(window).off("resize."+e.guid());}},show:function(){var e=this;
e.$el.show();if(e.autoManageEventBind){e.bind();}if(e.autoLayout){c(window).off("resize."+e.guid()).on(("resize."+e.guid()),function(){e.layoutChange();});}}});function a(e){b.each(e.bindings,function(g,f){var h=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(f);e.$container.off(h[1],h[2]);});}function d(e){var f=typeof e.bindings==="function"?e.bindings():e.bindings;
b.each(f,function(h,g){var i=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(g);e.$container.on(i[1],i[2],function(j){h.call(e,j,this);});});}}(HAF,HAF.DOM));(function(a){a.registerHelper("list",function(d,j,f){var e,h,b,g="",c="";if(typeof j==="string"){g=" class='"+j+"' ";c=" class='"+j+"-item' ";}else{f=j;
}e="<ul"+g+">";if(d&&d.length){for(h=0,b=d.length;h<b;h++){e+="<li"+c+">"+f.fn(d[h])+"</li>";}}return e+"</ul>";});}(Handlebars));(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");
}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(HAF));(function(a,c){var b=function(){this.messageBus=c({});};b.prototype={publish:function(d,e){this.messageBus.trigger(d,[e]);
},subscribe:function(f,e,g){var d=function(i,h){g.call(f,h);};this.messageBus.on(e,d);return d;},unsubscribe:function(d,e){this.messageBus.off(d,e);}};a.messaging=new b();a.Messaging=b;}(HAF,HAF.DOM));(function(a,e){var f;var b;var d={};var c=function(){function m(n){e(window).on("hashchange",k);if(location.hash){k();
}else{location.href="#/"+n;}}function k(){b=location.hash;var n=l(b);if(n.page!==f){g(f,n);f=n.page;h(f,n);}d[f]=n;a.messaging.publish("navigationStateChange:"+f,n);a.messaging.publish("navigationStateChange",n);}function g(o,n){if(o){e("a[href$='#/"+o+"']").removeClass("selected");e("#"+o).removeClass("page-visible");
a.messaging.publish("navigationChangedFrom:"+o,n);}}function h(p,n){e("#"+p).addClass("page-visible");e("a[href$='#/"+p+"']").addClass("selected");var o=d[p];if(o){if(o.moduleItem){location.replace("#/"+p+"/"+o.module+"/"+o.moduleItem);}}a.messaging.publish("navigationChangedTo:"+f,n);}function l(o){var n=o.substr(1).split("/");
return{path:o,page:n[1],module:n[2],moduleItem:n[3]};}function j(n){b=n;location.hash=n;if(window.hasOwnProperty("onhashchange")){k();}}function i(p,q,r,n){var o=new RegExp(("^"+q+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(s){return"([a-zA-Z0-9-_]+)";})).exec(b.substring(1).replace(/[\/]?$/,""));
if(o){o.splice(0,1);r.apply(p,o);}else{if(n){n.call(p);}}}return{load:m,route:i,setRoute:j};};a.navigation=new c();}(HAF,HAF.DOM));(function(c,e){c.templateEngine={getById:g,getByCSSSelector:d,getByURL:b,process:f,remove:a};function b(i,j){e.get(i,function(k){j(h(k));});}function h(i){return Handlebars.compile(i);
}function a(j){var i=e("#"+j);i.remove();}function g(k){var i=e("#"+k);var j=i.html();i.remove();if(!j){throw new Error("Template id: "+k+", not found!!");}else{return h(j);}}function d(j){var i=e(j).html();if(!i){throw new Error("Template selector: "+j+", not matched any!!");}else{return h(i);}}function f(j,i){return j(i);
}}(HAF,HAF.DOM));