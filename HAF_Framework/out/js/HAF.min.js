/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(d,c){a.i18nT=c;a.Module=d||{};};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(a){a.noop=d;a.each=e;function e(f,g){if(f){if(f instanceof Array){c(f,g);
}else{b(f,g);}}}function b(f,h){var g;if(f){for(g in f){if(f.hasOwnProperty(g)){h(f[g],g);}}}}function c(h,j){var g,f;if(h){for(g=0,f=h.length;g<f;g++){j(h[g],g);}}}function d(){}}(HAF));(function(a,d){var b=function(){this.localMessageBus=d({});};b.prototype={publish:function(e,f){this.localMessageBus.trigger(e,[f]);
},subscribe:function(g,e,f){var h=this;if(typeof e==="string"){return c(h,f,g,e);}var i={};a.each(e,function(k,j){i[j]=c(h,k,g,j);});return i;},unsubscribe:function(e,f){var g=this;if(typeof e==="string"){g.localMessageBus.off(e,f);}else{a.each(e,function(i,h){g.localMessageBus.off(h,i);});}}};function c(e,i,h,g){var f=function(k,j){i.call(h,j);
};e.localMessageBus.on(g,f);return f;}a.messaging=new b();a.Messaging=b;}(HAF,HAF.DOM));(function(b){b.Base=Class.extend({_guid:null,messageBus:b.messaging,injector:null,guid:function(){if(!this._guid){this._guid=c();}return this._guid;},injectDependencies:function(d){b.dependencyInjector(this,d);}});
function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}}(HAF));(function(h){h.Controller=h.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,autoLayout:false,messages:null,injectLocalMessageBus:false,inject:null,routes:{},serviceUpdate:{},messageBus:h.messaging,localMessageBus:null,init:function(u){this.injectDependencies(u);
},views:null,templates:null,controls:null,services:null,shownAndLoaded:false,layoutChange:function(){if(this.autoLayout){r(this.controls,"layoutChange");r(this.views,"layoutChange");}},load:function(){m(this);b(this);},unload:function(){k(this);f(this);},update:function(u){d(this,u);},onUpdateReceive:function(v,u){g(this,v,u);
},destroy:function(){s(this);},onRouteChange:function(){return this.routes;},onServiceUpdate:function(){return this.serviceUpdate;},hide:function(u){o(this);if(!(u&&u.keepPreviousState)){e(this,false);n(this);}},show:function(u){if(!this.shownAndLoaded){l(this);this.shownAndLoaded=true;}else{if(u&&u.keepPreviousState){p(this);
}else{a(this);}}}});function l(u){e(u,true);j(u);}function a(u){e(u,true);p(u);}function f(u){r(u.controls,"unload");}function b(u){if(u.autoLoadControls){r(u.controls,"load");}}function j(u){if(!u._exist&&u.autoWire){t(u.services,u);}u._exist=true;}function n(u){if(u.autoDestroy){u.destroy();}}function p(u){if(u.autoWire){r(u.services,"start");
}}function o(u){if(u.autoWire){r(u.services,"stop");}}function g(u,w,v){u.controls[v].update(w);if(u.lastStateData&&u.onServiceUpdate()[v]){u.onServiceUpdate()[v].call(u,u.controls[v],u.lastStateData);}}function d(u,v){if(u.autoWire){q(u,v);}}function s(u){i(u);k(u);r(u.views,"destroy");r(u.controls,"destroy");
r(u.services,"destroy");u.services=null;u.views=null;u.lastStateData=null;u.templates=null;u.options=null;u.controls=null;u._exist=false;u.shownAndLoaded=false;}function i(u){if(u.controlMessages){var v=u.controlMessages;h.messaging.unsubscribe(v.show);h.messaging.unsubscribe(v.hide);h.messaging.unsubscribe(v.stateChange);
}}function k(u){h.each(u.messages,function(v){h.messaging.unsubscribe(v);});}function q(u,v){h.each(u.templates,function(x,w){x.load(function(){u.views[w].render(x.process(v));});});}function r(v,w,u){h.each(v,function(x){x[w](u);});}function t(u,v){h.each(u,function(w,x){w.onUpdate(c(v,x));w.fetch();
});}function c(v,u){return function(w){v.onUpdateReceive(w,u);};}function m(u){if(!(u.messages||u.controlMessages)){return;}i(u);var v=u.controlMessages;h.messaging.subscribe(u,v.show,u.show);h.messaging.subscribe(u,v.hide,u.hide);h.messaging.subscribe(u,v.stateChange,function(w){u.lastStateData=w;h.each(u.onRouteChange(w),function(y,x){h.navigation.route(u,x,y);
});});h.each(u.messages,function(x,w){h.messaging.subscribe(u,w,x);});}function e(v,u){if(v.autoShowHide){r(v.views,u?"show":"hide");r(v.controls,u?"show":"hide");}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];
},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);});},update:b.noop,get:b.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;
g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];},stop:b.noop,start:b.noop});}(HAF,HAF.DOM));(function(a){var b={};a.TemplateByString=function(c){return new a.Template(c,a.Template.LOAD.BY_STRING);};a.TemplateByID=function(c){return new a.Template(c,a.Template.LOAD.BY_ID);
};a.TemplateByURL=function(c){return new a.Template(c,a.Template.LOAD.BY_URL);};a.TemplateSafeString=function(c){return new a.templateEngine.safeString(c);};a.Template=a.Base.extend({init:function(c,d){this.path=c;this.loadBy=d||a.Template.LOAD.DEFAULT;},process:function(c){if(this.path===undefined){return"";
}if(!b[this.guid()]){console.log("Template param: ",this.path,this.loadBy);throw new Error("Template not in cache!!");}return a.templateEngine.process(b[this.guid()],c);},load:function(d){var c=this;if(this.path===undefined||b[this.guid()]){d();}else{if(c.loadBy===a.Template.LOAD.BY_URL){a.templateEngine.getByURL(c.path,function(e){b[c.guid()]=e;
d.call(c);});}else{if(this.loadBy===a.Template.LOAD.BY_ID){b[this.guid()]=a.templateEngine.getById(this.path);a.templateEngine.remove(this.path);setTimeout(function(){d.call(c);},5);}else{b[this.guid()]=a.templateEngine.getByString(this.path);setTimeout(function(){d.call(c);},5);}}}},destroy:function(){delete b[this.guid()];
}});a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",BY_STRING:"APP_TEMPLATE_BY_STRING",DEFAULT:"APP_TEMPLATE_BY_ID"};}(HAF));(function(d,f){d.View=d.Base.extend({autoManageEventBind:false,autoLayout:false,init:function(i){this.injectDependencies(i);this.$container=f(this.container);
this.$el=this.$container.$item;if(!this.autoManageEventBind){this.bind();}b(this);},container:null,$container:null,bindings:null,layoutChange:d.noop,bind:function(){h(this);},unbind:function(){a(this);},$el:null,render:function(i){this.$container.html(i);},destroy:function(){var i=this;c(i);i.unbind();
i.$container.empty();},hide:function(){var i=this;i.$el.removeClass("show").addClass("hide");e(i);c(i);},show:function(){var i=this;i.$el.removeClass("hide").addClass("show");g(i);b(i);}});function a(i){d.each(i.bindings,function(k,j){var l=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(j);i.$container.off(l[1],l[2]);
});}function h(i){var j=typeof i.bindings==="function"?i.bindings():i.bindings;d.each(j,function(l,k){var m=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(k);i.$container.on(m[1],m[2],function(n){l.call(i,n,this);});});}function b(i){if(i.autoLayout){f(window).off("resize."+i.guid()).on(("resize."+i.guid()),function(){i.layoutChange();
});}}function c(i){if(i.autoLayout){f(window).off("resize."+i.guid());}}function e(i){if(i.autoManageEventBind){i.unbind();}}function g(i){if(i.autoManageEventBind){i.bind();}}}(HAF,HAF.DOM));(function(b){b.dependencyInjector=h;var c={"views":"view","templates":"template","services":"service","controls":"controller"};
function h(i,j){if(b.Messaging&&(j instanceof b.Messaging)){i.messageBus=j;}if(i.injectLocalMessageBus){i.localMessageBus=(j&&j.inject&&j.inject.localMessageBus)||new b.Messaging();}var k=(j&&j.inject)||(i.inject&&(typeof i.inject==="function"?i.inject():i.inject));b.each(k,function(l,m){var n=/^controls$|^templates$|^views$|^services$/.exec(m);
if(n&&(l instanceof Array)){b.each(l,function(o){i[m]=i[m]||{};if(typeof o==="string"){i[m][o]=i[o]||{};e(i[m],o,d(i,m,o));}else{b.each(o,function(q,p){e(i[m],p,f(q,i,m));});}});}else{i[m]=f(l,i,m);}});}function f(j,i,k){return(typeof j==="string")?d(i,k,j):j;}function e(i,j,k){i[j]=k;}function d(i,k,j){if(i.injector){b.Module.dependency=b.Module.dependency||{};
var l=b.Module.dependency[i.injector];if(l){if(l[k][j]){return l[k][j](i);}}}return g(i,k,j);}function a(i){return i.substr(0,1).toUpperCase()+i.substr(1);}function g(i,k,j){if(k==="templates"){b.Module.template=b.Module.template||{};if(b.Module.template[a(j)]){return new b.Module.template[a(j)]();}if(b.Module.template[j]){return b.Module.template[j];
}return new b.Template("tmpl"+a(j));}var m=c[k];b.Module[m]=b.Module[m]||{};try{return new b.Module[m][a(j)](i.injectLocalMessageBus?i.localMessageBus:i.messageBus);}catch(l){console.log(l);throw new Error("Dependency instance creation error: ("+k+","+j+" | "+m+"."+(a(j))+")");}}}(HAF));(function(a){a.registerHelper("list",function(d,j,f){var e,h,b,g="",c="";
if(typeof j==="string"){g=" class='"+j+"' ";c=" class='"+j+"-item' ";}else{f=j;}e="<ul"+g+">";if(d&&d.length){for(h=0,b=d.length;h<b;h++){e+="<li"+c+">"+f.fn(d[h])+"</li>";}}return e+"</ul>";});}(Handlebars));(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));
});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";
};}(HAF));(function(a,f){var h;var c;var e={};var g=false;var b="#/home";var d=function(){function p(t){b=t;f(window).on("hashchange",q);if(location.hash){q();}else{location.href="#/"+b;}}function q(){c=location.hash;var u=n(c);if(!u){location.href="#/"+b;return;}if(u.page!==h){i(h,u);h=u.page;l(h,u);
}var t=n(location.hash);if(!g){if(!m(h)||r(t)){k(t);}}e[h]=u;window.setTimeout(function(){g=false;},200);}function r(t){return(!e[h]||(t.pageData!==e[t.page].pageData));}function k(t){a.messaging.publish("navigationStateChange:"+h,t);a.messaging.publish("navigationStateChange",t);}function i(u,t){if(u){f("a[href$='#/"+u+"']").removeClass("selected");
f("#"+u).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+u,t);}}function l(w,u){f("#"+w).addClass("page-visible");var t=s(w);t.addClass("selected");var v=e[w];if(v){if(v.pageData){location.replace("#/"+w+"/"+v.pageData);if(m(w)){g=true;}}}if(!g){a.messaging.publish("navigationChangedTo:"+h,u);
}}function m(u){var t=s(u).attr("data-keep-state");return !(t===false||t==="false");}function s(t){return f("a[href$='#/"+t+"']");}function n(u){var t=/#\/([a-zA-Z_\-0-9\$]+)(\/([\w\W]+))?/.exec(u);if(!t){return null;}return{path:u,page:t[1],pageData:t[3],keepPreviousState:m(t[1])};}function j(t){c=t;
location.hash=t;if(window.hasOwnProperty("onhashchange")){q();}}function o(v,w,x,t){var u=new RegExp(("^"+w+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(y){return"([a-zA-Z0-9-_]+)";})).exec(c.substring(1).replace(/[\/]?$/,""));if(u){u.splice(0,1);x.apply(v,u);}else{if(t){t.call(v);}}}return{load:p,route:o,setRoute:j};
};a.navigation=new d();}(HAF,HAF.DOM));(function(j,e){j.templateEngine={getById:i,getByCSSSelector:g,getByURL:b,getByString:c,process:a,safeString:d,remove:f};function b(k,l){e.get(k,function(m){l(h(m));});}function d(k){return new Handlebars.SafeString(k);}function h(k){return Handlebars.compile(k);
}function f(l){var k=e("#"+l);k.remove();}function c(k){return h(k);}function i(m){var k=e("#"+m);var l=k.html();k.remove();if(!l){throw new Error("Template id: "+m+", not found!!");}else{return h(l);}}function g(l){var k=e(l).html();if(!k){throw new Error("Template selector: "+l+", not matched any!!");
}else{return h(k);}}function a(l,k){return l(k);}}(HAF,HAF.DOM));