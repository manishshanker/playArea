/*!
 * Copyright 2011-2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 * @timestamp 09022014104737
 */
(function(a,b){b.HAF=a=a||{};
a.init=function(d,c){a.i18nT=c;a.Module=d||{};};}(window.HAF,window));(function(b,d){function c(e){return new a(d(e));}c.get=function(){return d.get.apply(this,arguments);};c.grep=function(){return d.grep.apply(this,arguments);};var a=function(e){this.$item=e;};a.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};b.DOM=c;}(HAF,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(a){a.noop=d;a.each=e;a.infoLogger=(window.console&&window.console.log&&function(){console.info.apply(console,arguments);
})||a.noop;a.logger=(window.console&&window.console.log&&function(){console.log.apply(console,arguments);})||a.noop;a.errorLogger=(window.console&&window.console.log&&function(){console.error.apply(console,arguments);})||a.noop;a.warningLogger=(window.console&&window.console.log&&function(){console.warn.apply(console,arguments);
})||a.noop;function e(f,g){if(f){if(f instanceof Array){c(f,g);}else{b(f,g);}}}function b(f,h){var g;if(f){for(g in f){if(f.hasOwnProperty(g)){h(f[g],g);}}}}function c(h,j){var g,f;if(h){for(g=0,f=h.length;g<f;g++){j(h[g],g);}}}function d(){}}(HAF));(function(b,f){var d=function(){this.guid=c();this.localMessageBus=f({});
};d.prototype={publish:function(g,h){this.localMessageBus.trigger(g,[h]);},subscribe:function(i,g,h){if(typeof i==="string"){h=g;g=i;i=window;}var j=this;if(typeof g==="string"){return e(j,h,i,g);}var k={};b.each(g,function(m,l){k[l]=e(j,m,i,l);});return k;},unsubscribe:function(g,h){var i=this;if(typeof g==="string"){i.localMessageBus.off(g,h);
}else{b.each(g,function(k,j){i.localMessageBus.off(j,k);});}}};function e(g,k,j,i){var h=function(m,l){k.call(j,l);};g.localMessageBus.on(i,h);return h;}function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);
}b.messaging=new d();b.Messaging=d;}(HAF,HAF.DOM));(function(b){b.Base=Class.extend({_guid:null,messageBus:b.messaging,injector:null,guid:function(){if(!this._guid){this._guid=c();}return this._guid;},injectDependencies:function(d){b.dependencyInjector(this,d);}});function c(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();
}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}}(HAF));(function(h){h.Controller=h.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,autoLayout:false,messages:null,injectLocalMessageBus:false,inject:null,routes:{},serviceUpdate:{},messageBus:h.messaging,localMessageBus:null,init:function(u){this.injectDependencies(u);
},views:null,templates:null,controls:null,services:null,shownAndLoaded:false,layoutChange:function(){if(this.autoLayout){r(this.controls,"layoutChange");r(this.views,"layoutChange");}},load:function(){m(this);b(this);},unload:function(){k(this);f(this);},update:function(u){d(this,u);},onUpdateReceive:function(v,u){g(this,v,u);
},destroy:function(){s(this);},onRouteChange:function(){return this.routes;},onServiceUpdate:function(){return this.serviceUpdate;},hide:function(u){o(this);if(!(u&&u.keepPreviousState)){e(this,false,arguments);n(this);}},show:function(u){if(!this.shownAndLoaded){l(this,arguments);this.shownAndLoaded=true;
}else{if(u&&u.keepPreviousState){p(this);}else{a(this,arguments);}}}});function l(u,v){e(u,true,v);j(u);}function a(u,v){e(u,true,v);p(u);}function f(u){r(u.controls,"unload");}function b(u){if(u.autoLoadControls){r(u.controls,"load");}}function j(u){if(!u._exist&&u.autoWire){t(u.services,u);}u._exist=true;
}function n(u){if(u.autoDestroy){u.destroy();}}function p(u){if(u.autoWire){r(u.services,"start");}}function o(u){if(u.autoWire){r(u.services,"stop");}}function g(u,w,v){u.controls[v].update(w);if(u.lastStateData&&u.onServiceUpdate()[v]){u.onServiceUpdate()[v].call(u,u.controls[v],u.lastStateData);}}function d(u,v){if(u.autoWire){q(u,v);
}}function s(u){i(u);k(u);r(u.views,"destroy");r(u.controls,"destroy");r(u.services,"destroy");u.services=null;u.views=null;u.lastStateData=null;u.templates=null;u.options=null;u.controls=null;u._exist=false;u.shownAndLoaded=false;}function i(u){if(u.controlMessages){var v=u.controlMessages;h.messaging.unsubscribe(v.show);
h.messaging.unsubscribe(v.hide);h.messaging.unsubscribe(v.stateChange);}}function k(u){h.each(u.messages,function(v){h.messaging.unsubscribe(v);});}function q(u,v){h.each(u.templates,function(x,w){x.load(function(){if(u.views[w]){u.views[w].render(x.process(v));}});});}function r(v,w,u){u=u||[];h.each(v,function(x){x[w].apply(x,u);
});}function t(u,v){h.each(u,function(w,x){w.onUpdate(c(v,x));w.fetch();});}function c(v,u){return function(w){v.onUpdateReceive(w,u);};}function m(u){if(!(u.messages||u.controlMessages)){return;}i(u);var v=u.controlMessages;h.messaging.subscribe(u,v.show,u.show);h.messaging.subscribe(u,v.hide,u.hide);
h.messaging.subscribe(u,v.stateChange,function(w){u.lastStateData=w;h.each(u.onRouteChange(w),function(y,x){h.navigation.route(u,x,y);});});h.each(u.messages,function(x,w){h.messaging.subscribe(u,w,x);});}function e(w,u,v){if(w.autoShowHide){r(w.views,u?"show":"hide",v);r(w.controls,u?"show":"hide",v);
}}}(HAF));(function(b,c){var a={};b.Service=b.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];},fetch:function(){c.get(this.dataURL,function(d){this.updated(d);});},update:b.noop,get:b.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);
},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];},stop:b.noop,start:b.noop});}(HAF,HAF.DOM));(function(a,c){var b={};a.TemplateByString=function(f){return new a.Template(f,a.Template.LOAD.BY_STRING);
};a.TemplateByID=function(f){return new a.Template(f,a.Template.LOAD.BY_ID);};a.TemplateByURL=function(f){return new a.Template(f,a.Template.LOAD.BY_URL);};a.TemplateSafeString=function(f){return new a.templateEngine.safeString(f);};a.Template=a.Base.extend({init:function(f,g){this.path=f;this.loadBy=g||a.Template.LOAD.DEFAULT;
},process:function(f){if(this.path===undefined){return"";}if(!b[this.guid()]){console.log("Template param: ",this.path,this.loadBy);throw new Error("Template not in cache!!");}return a.templateEngine.process(b[this.guid()],f);},load:function(h){var f=this;if(this.path===undefined||b[this.guid()]){h();
}else{if(f.loadBy===a.Template.LOAD.BY_URL){var g=e(d(a.Template.LOAD.BY_URL_DEFAULT_PATH)+f.path);a.templateEngine.getByURL(g,function(i){b[f.guid()]=i;h.call(f);});}else{if(this.loadBy===a.Template.LOAD.BY_ID){b[this.guid()]=a.templateEngine.getById(this.path);a.templateEngine.remove(this.path);setTimeout(function(){h.call(f);
},5);}else{b[this.guid()]=a.templateEngine.getByString(this.path);setTimeout(function(){h.call(f);},5);}}}},destroy:function(){delete b[this.guid()];}});function e(f){return f+(/\.[a-z]{3,4}$/.test(f)?"":a.Template.LOAD.BY_URL_DEFAULT_EXTENSION);}function d(f){return f+(/\/$/.test(f)?"":"/");}a.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",BY_STRING:"APP_TEMPLATE_BY_STRING",DEFAULT:"APP_TEMPLATE_BY_ID",BY_URL_DEFAULT_PATH:c.HAF_Template_LOAD_BY_URL_DEFAULT_PATH||"",BY_URL_DEFAULT_EXTENSION:c.HAF_Template_LOAD_BY_URL_DEFAULT_EXTENSION||".hbs"};
}(HAF,window));(function(d,f){d.View=d.Base.extend({autoManageEventBind:false,autoLayout:false,init:function(i){this.injectDependencies(i);this.$container=f(this.container);this.$el=this.$container.$item;if(!this.autoManageEventBind){this.bind();}b(this);},container:null,$container:null,bindings:null,layoutChange:d.noop,bind:function(){h(this);
},unbind:function(){a(this);},$el:null,render:function(i){this.$container.html(i);},destroy:function(){var i=this;c(i);i.unbind();i.$container.empty();},hide:function(){var i=this;i.$el.removeClass("show").addClass("hide");e(i);c(i);},show:function(){var i=this;i.$el.removeClass("hide").addClass("show");
g(i);b(i);}});function a(i){d.each(i.bindings,function(k,j){var l=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(j);i.$container.off(l[1],l[2]);});}function h(i){var j=typeof i.bindings==="function"?i.bindings():i.bindings;d.each(j,function(l,k){var m=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(k);i.$container.on(m[1],m[2],function(n){l.call(i,n,this);
});});}function b(i){if(i.autoLayout){f(window).off("resize."+i.guid()).on(("resize."+i.guid()),function(){i.layoutChange();});}}function c(i){if(i.autoLayout){f(window).off("resize."+i.guid());}}function e(i){if(i.autoManageEventBind){i.unbind();}}function g(i){if(i.autoManageEventBind){i.bind();}}}(HAF,HAF.DOM));
(function(k){k.dependencyInjector=c;var d={"views":"view","templates":"template","services":"service","controls":"controller"};function c(m,n){if(k.Messaging&&(n instanceof k.Messaging)){m.messageBus=n;}if(m.injectLocalMessageBus){m.localMessageBus=(n&&n.inject&&n.inject.localMessageBus)||new k.Messaging();
}var o=(n&&n.inject)||(m.inject&&(b(m.inject)?m.inject():m.inject));o=i(o);k.each(o,function(p,q){var r=/^controls$|^templates$|^views$|^services$/.exec(q);if(r){if(p instanceof Array){f(p,m,q);}else{if(b(p)){m[q]=p.call(m,m);}else{k.each(p,function(t,s){m[q]=m[q]||{};m[q][s]=m[q][s]={};h(m[q],s,e(t,m,q));
});}}}else{m[q]=e(p,m,q);}});}function f(n,m,o){k.each(n,function(p){m[o]=m[o]||{};if(a(p)){m[o][p]=m[p]||{};h(m[o],p,j(m,o,p));}else{k.each(p,function(r,q){h(m[o],q,e(r,m,o));});}});}function e(n,m,o){return a(n)?j(m,o,n):(b(n)?n():n);}function h(m,n,o){m[n]=o;}function j(m,o,n){if(m.injector){k.Module.dependency=k.Module.dependency||{};
var p=k.Module.dependency[m.injector];if(p){if(p[o][n]){return p[o][n](m);}}}return g(m,o,n);}function l(m){return m.substr(0,1).toUpperCase()+m.substr(1);}function g(m,o,n){if(o==="templates"){k.Module.template=k.Module.template||{};if(k.Module.template[l(n)]){return new k.Module.template[l(n)]();}if(k.Module.template[n]){return k.Module.template[n];
}if(n.indexOf("tmpl!")===0){return k.TemplateByURL(n.substr(5));}return k.TemplateByID("tmpl"+l(n));}var q=d[o];k.Module[q]=k.Module[q]||{};try{return new k.Module[q][l(n)](m.injectLocalMessageBus?m.localMessageBus:m.messageBus);}catch(p){k.errorLogger(p);throw new Error("Dependency instance creation error: ("+o+","+n+" | "+q+"."+(l(n))+")");
}}function i(q){if(a(q)){var p={};var o=q.split(":");var n=o[1];var m=o[0];k.each({"templates":/T/,"views":/V/,"services":/S/},function(s,r){if(s.test(m)){p[r]=[n];}});q=p;}return q;}function b(m){return typeof m==="function";}function a(m){return typeof m==="string";}}(HAF));(function(a){a.registerHelper("list",function(d,j,f){var e,h,b,g="",c="";
if(typeof j==="string"){g=" class='"+j+"' ";c=" class='"+j+"-item' ";}else{f=j;}e="<ul"+g+">";if(d&&d.length){for(h=0,b=d.length;h<b;h++){e+="<li"+c+">"+f.fn(d[h])+"</li>";}}return e+"</ul>";});}(Handlebars));(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));
});}(HAF));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";
};}(HAF));(function(a,f){var h;var c;var e={};var g=false;var b="#/home";var d=function(){function p(t){b=t;f(window).on("hashchange",q);if(location.hash){q();}else{location.href="#/"+b;}}function q(){c=location.hash;var u=n(c);if(!u){location.href="#/"+b;return;}if(u.page!==h){i(h,u);h=u.page;l(h,u);
}var t=n(location.hash);if(!g){if(!m(h)||r(t)){k(t);}}e[h]=u;window.setTimeout(function(){g=false;},200);}function r(t){return(!e[h]||(t.pageData!==e[t.page].pageData));}function k(t){a.messaging.publish("navigationStateChange:"+h,t);a.messaging.publish("navigationStateChange",t);}function i(u,t){if(u){f("a[href$='#/"+u+"']").removeClass("selected");
f("#"+u).removeClass("page-visible");a.messaging.publish("navigationChangedFrom:"+u,t);}}function l(w,u){f("#"+w).addClass("page-visible");var t=s(w);t.addClass("selected");var v=e[w];if(v){if(v.pageData){location.replace("#/"+w+"/"+v.pageData);if(m(w)){g=true;}}}if(!g){a.messaging.publish("navigationChangedTo:"+h,u);
}}function m(u){var t=s(u).attr("data-keep-state");return !(t===false||t==="false");}function s(t){return f("a[href$='#/"+t+"']");}function n(u){var t=/#\/([a-zA-Z_\-0-9\$]+)(\/([\w\W]+))?/.exec(u);if(!t){return null;}return{path:u,page:t[1],pageData:t[3],keepPreviousState:m(t[1])};}function j(t){c=t;
location.hash=t;if(window.hasOwnProperty("onhashchange")){q();}}function o(v,w,x,t){var u=new RegExp(("^"+w+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(y){return"([a-zA-Z0-9-_]+)";})).exec(c.substring(1).replace(/[\/]?$/,""));if(u){u.splice(0,1);x.apply(v,u);}else{if(t){t.call(v);}}}return{load:p,route:o,setRoute:j};
};a.navigation=new d();}(HAF,HAF.DOM));(function(j,e){j.templateEngine={getById:i,getByCSSSelector:g,getByURL:b,getByString:c,process:a,safeString:d,remove:f};function b(k,l){e.get(k,function(m){l(h(m));});}function d(k){return new Handlebars.SafeString(k);}function h(k){return Handlebars.compile(k);
}function f(l){var k=e("#"+l);k.remove();}function c(k){return h(k);}function i(m){var k=e("#"+m);var l=k.html();k.remove();if(!l){throw new Error("Template id: "+m+", not found!!");}else{return h(l);}}function g(l){var k=e(l).html();if(!k){throw new Error("Template selector: "+l+", not matched any!!");
}else{return h(k);}}function a(l,k){return l(k);}}(HAF,HAF.DOM));